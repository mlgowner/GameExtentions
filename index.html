<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Mods Catalog</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            margin: 0;
            padding: 15px;
            line-height: 1.5;
        }
        h1 {
            text-align: center;
            color: #00ffcc;
            font-size: 24px;
            margin-bottom: 20px;
            text-shadow: 0 0 5px #00ffcc;
        }
        #search {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: none;
            border-radius: 5px;
            background: #2a2a2a;
            color: #e0e0e0;
            font-size: 16px;
        }
        #filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        select, button {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            background: #333;
            color: #e0e0e0;
            cursor: pointer;
            transition: background 0.3s;
        }
        select:hover, button:hover {
            background: #444;
        }
        .mod-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .mod-card {
            background: #252525;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s;
        }
        .mod-card:hover {
            transform: translateY(-5px);
        }
        .mod-card img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 5px;
        }
        .mod-name { font-weight: bold; color: #00ffcc; margin: 5px 0; }
        .mod-desc { font-size: 14px; color: #bbb; }
        .rating { color: #ffd700; font-size: 16px; }
        #details {
            background: #252525;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            margin-top: 20px;
            text-align: left;
        }
        #mod-img { width: 200px; border-radius: 5px; }
        #mod-download { text-decoration: none; }
        #pagination { text-align: center; margin-top: 20px; }
        #pagination button { margin: 0 5px; }
    </style>
</head>
<body>
    <h1>Minecraft Mods (как на Minecraft-Inside)</h1>
    
    <input type="text" id="search" placeholder="Поиск модов..." oninput="searchMods()">
    <div id="filters">
        <select id="version" onchange="loadMods()">
            <option value="">Все версии</option>
            <option value="1.21">1.21</option>
            <option value="1.20">1.20</option>
        </select>
        <select id="category" onchange="loadMods()">
            <option value="">Все категории</option>
            <option value="adventure">Приключения</option>
            <option value="magic">Магия</option>
            <option value="tech">Техника</option>
        </select>
        <select id="sort" onchange="loadMods()">
            <option value="popularity">Популярные</option>
            <option value="date">Новые</option>
        </select>
    </div>
    
    <div id="mods-grid" class="mod-grid"></div>
    <div id="pagination">
        <button onclick="prevPage()">Предыдущая</button>
        <span id="page-info">Страница 1</span>
        <button onclick="nextPage()">Следующая</button>
    </div>
    
    <div id="details">
        <h2 id="mod-title"></h2>
        <img id="mod-img" style="width: 200px;">
        <p id="mod-desc"></p>
        <p id="mod-downloads">Скачиваний: </p>
        <p id="mod-rating" class="rating">Рейтинг: ★★★★☆</p>
        <a id="mod-download" href="#" target="_blank"><button>Скачать</button></a>
        <button onclick="backToList()">Назад к списку</button>
    </div>

    <script>
        const API_KEY = 'YOUR_API_KEY'; // Вставь свой ключ CurseForge
        const GAME_ID = 4321; // Minecraft
        let currentPage = 1;
        let totalPages = 1;
        let allMods = [];

        Telegram.WebApp.ready();
        Telegram.WebApp.expand();

        async function loadMods(page = 1, search = '', version = '', category = '', sort = 'popularity') {
            currentPage = page;
            let url = `https://api.curseforge.com/v1/mods/search?gameId=${GAME_ID}&pageSize=20&page=${page-1}`;
            if (search) url += `&searchFilter=${encodeURIComponent(search)}`;
            if (version) url += `&gameVersion=${version}`;
            if (category) url += `&classId=${getClassId(category)}`;
            if (sort === 'popularity') url += '&sortField=2'; // Популярность
            else if (sort === 'date') url += '&sortField=4'; // Дата

            try {
                const response = await fetch(url, {
                    headers: { 'x-api-key': API_KEY }
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                allMods = data.data;
                totalPages = Math.ceil(data.pagination.totalCount / 20);
                displayMods(allMods);
                document.getElementById('page-info').textContent = `Страница ${page} из ${totalPages}`;
            } catch (error) {
                alert('Ошибка загрузки: ' + error.message + '. Проверь API-ключ или интернет.');
                console.error(error);
            }
        }

        function displayMods(mods) {
            const grid = document.getElementById('mods-grid');
            grid.innerHTML = '';
            mods.forEach(mod => {
                const card = document.createElement('div');
                card.className = 'mod-card';
                card.innerHTML = `
                    <img src="${mod.logo?.thumbnailUrl || 'https://via.placeholder.com/150'}" alt="${mod.name}" onclick="showDetails(${mod.id})">
                    <div class="mod-name">${mod.name}</div>
                    <div class="mod-desc">${mod.summary?.substring(0, 100)}...</div>
                    <div>Скачиваний: ${mod.downloadCount || 0}</div>
                    <div class="rating">★${'★'.repeat(Math.floor(mod.rating || 4))}</div>
                `;
                grid.appendChild(card);
            });
        }

        async function showDetails(modId) {
            const url = `https://api.curseforge.com/v1/mods/${modId}`;
            const response = await fetch(url, { headers: { 'x-api-key': API_KEY } });
            const mod = await response.json();
            document.getElementById('mod-title').textContent = mod.data.name;
            document.getElementById('mod-img').src = mod.data.logo?.thumbnailUrl || 'https://via.placeholder.com/200';
            document.getElementById('mod-desc').textContent = mod.data.summary;
            document.getElementById('mod-downloads').textContent = `Скачиваний: ${mod.data.downloadCount || 0}`;
            document.getElementById('mod-rating').textContent = `Рейтинг: ★${'★'.repeat(Math.floor(mod.data.rating || 4))}`;
            document.getElementById('mod-download').href = mod.data.links?.websiteUrl || '#';
            document.getElementById('mods-grid').style.display = 'none';
            document.getElementById('pagination').style.display = 'none';
            document.getElementById('details').style.display = 'block';
        }

        function backToList() {
            document.getElementById('details').style.display = 'none';
            document.getElementById('mods-grid').style.display = 'grid';
            document.getElementById('pagination').style.display = 'block';
        }

        function searchMods() {
            const query = document.getElementById('search').value;
            loadMods(1, query, document.getElementById('version').value, document.getElementById('category').value, document.getElementById('sort').value);
        }

        function nextPage() { if (currentPage < totalPages) loadMods(currentPage + 1); }
        function prevPage() { if (currentPage > 1) loadMods(currentPage - 1); }

        function getClassId(cat) {
            const map = { adventure: 4450, magic: 4349, tech: 4231 };
            return map[cat] || '';
        }

        loadMods();
    </script>
</body>
</html>
