<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Mods Catalog</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #f0f0f0; margin: 0; padding: 10px; }
        #search { width: 100%; padding: 10px; margin-bottom: 10px; }
        #filters { margin-bottom: 10px; }
        .mod-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
        .mod-card { background: white; border: 1px solid #ddd; padding: 10px; text-align: center; border-radius: 5px; }
        .mod-card img { width: 100%; height: 100px; object-fit: cover; }
        .mod-name { font-weight: bold; }
        .mod-desc { font-size: 12px; }
        .rating { color: gold; }
        #details { display: none; background: white; padding: 20px; margin-top: 20px; }
        button { background: #0088cc; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Minecraft Mods (как на Minecraft-Inside)</h1>
    
    <input type="text" id="search" placeholder="Поиск модов..." oninput="searchMods()">
    <div id="filters">
        <select id="version" onchange="loadMods()">
            <option value="">Все версии</option>
            <option value="1.21">1.21</option>
            <option value="1.20">1.20</option>
            <!-- Добавь больше версий из API -->
        </select>
        <select id="category" onchange="loadMods()">
            <option value="">Все категории</option>
            <option value="adventure">Приключения</option>
            <option value="magic">Магия</option>
            <option value="tech">Техника</option>
            <!-- Больше из API: classId=6 для модов, категории по gameCategoryId -->
        </select>
        <select id="sort" onchange="loadMods()">
            <option value="popularity">Популярные</option>
            <option value="date">Новые</option>
        </select>
    </div>
    
    <div id="mods-grid" class="mod-grid"></div>
    <div id="pagination">
        <button onclick="prevPage()">Предыдущая</button>
        <span id="page-info">Страница 1</span>
        <button onclick="nextPage()">Следующая</button>
    </div>
    
    <div id="details">
        <h2 id="mod-title"></h2>
        <img id="mod-img" style="width: 200px;">
        <p id="mod-desc"></p>
        <p id="mod-downloads">Скачиваний: </p>
        <p id="mod-rating" class="rating">Рейтинг: ★★★★☆</p>
        <a id="mod-download" href="#" target="_blank"><button>Скачать</button></a>
        <button onclick="backToList()">Назад к списку</button>
    </div>

    <script>
        const API_KEY = 'YOUR_API_KEY'; // Вставь свой ключ CurseForge
        const GAME_ID = 4321; // Minecraft
        let currentPage = 1;
        let totalPages = 1;
        let allMods = [];

        Telegram.WebApp.ready(); // Инициализация Telegram Mini App
        Telegram.WebApp.expand(); // Расширить на весь экран

        async function loadMods(page = 1, search = '', version = '', category = '', sort = 'popularity') {
            currentPage = page;
            let url = `https://api.curseforge.com/v1/mods/search?gameId=${GAME_ID}&pageSize=20&pageNumber=${page-1}`;
            if (search) url += `&searchFilter=${search}`;
            if (version) url += `&version=${version}`; // Фильтр по версии (адаптируй)
            if (category) url += `&classId=${getClassId(category)}`; // classId для категорий
            if (sort === 'popularity') url += '&sortBy=1'; // Популярность
            else if (sort === 'date') url += '&sortBy=2'; // Дата

            try {
                const response = await fetch(url, {
                    headers: { 'x-api-key': API_KEY }
                });
                const data = await response.json();
                allMods = data.data;
                totalPages = Math.ceil(data.pagination.totalCount / 20);
                displayMods(allMods);
                document.getElementById('page-info').textContent = `Страница ${page} из ${totalPages}`;
            } catch (error) {
                alert('Ошибка загрузки: ' + error);
            }
        }

        function displayMods(mods) {
            const grid = document.getElementById('mods-grid');
            grid.innerHTML = '';
            mods.forEach(mod => {
                const card = document.createElement('div');
                card.className = 'mod-card';
                card.innerHTML = `
                    <img src="${mod.logo?.url || ''}" alt="${mod.name}" onclick="showDetails(${mod.id})">
                    <div class="mod-name">${mod.name}</div>
                    <div class="mod-desc">${mod.summary?.substring(0, 100)}...</div>
                    <div>Скачиваний: ${mod.downloadCount || 0}</div>
                    <div class="rating">★${'★'.repeat(Math.floor(mod.rating || 4))}</div>
                `;
                grid.appendChild(card);
            });
        }

        async function showDetails(modId) {
            const url = `https://api.curseforge.com/v1/mods/${modId}`;
            const response = await fetch(url, { headers: { 'x-api-key': API_KEY } });
            const mod = await response.json();
            document.getElementById('mod-title').textContent = mod.data.name;
            document.getElementById('mod-img').src = mod.data.logo?.url || '';
            document.getElementById('mod-desc').textContent = mod.data.summary;
            document.getElementById('mod-downloads').textContent = `Скачиваний: ${mod.data.downloadCount}`;
            document.getElementById('mod-rating').textContent = `Рейтинг: ★${'★'.repeat(Math.floor(mod.data.rating || 4))}`;
            document.getElementById('mod-download').href = mod.data.links?.websiteUrl || mod.data.downloadUrl;
            document.getElementById('mods-grid').style.display = 'none';
            document.getElementById('pagination').style.display = 'none';
            document.getElementById('details').style.display = 'block';
        }

        function backToList() {
            document.getElementById('details').style.display = 'none';
            document.getElementById('mods-grid').style.display = 'grid';
            document.getElementById('pagination').style.display = 'block';
        }

        function searchMods() {
            const query = document.getElementById('search').value;
            loadMods(1, query, document.getElementById('version').value, document.getElementById('category').value, document.getElementById('sort').value);
        }

        function nextPage() { if (currentPage < totalPages) loadMods(currentPage + 1); }
        function prevPage() { if (currentPage > 1) loadMods(currentPage - 1); }

        function getClassId(cat) {
            // Маппинг категорий (из CurseForge docs: https://docs.curseforge.com/rest-api/#get-/v1/categories)
            const map = { adventure: 4450, magic: 4349, tech: 4231 }; // Примеры classId для MC
            return map[cat] || '';
        }

        // Загрузка по умолчанию
        loadMods();
    </script>
</body>
</html>
